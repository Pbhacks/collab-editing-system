{"ast":null,"code":"// websocket.js\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nlet stompClient = null;\nexport function connectWebSocket(docId, onMessage, onConnect) {\n  return new Promise(resolve => {\n    try {\n      stompClient = new Client({\n        webSocketFactory: () => new SockJS(\"http://localhost:8082/ws\"),\n        debug: () => {},\n        // disable logs\n        reconnectDelay: 5000,\n        // auto reconnect every 5s\n        onConnect: () => {\n          const sub = stompClient.subscribe(`/topic/document/${docId}`, msg => {\n            if (msg.body) {\n              try {\n                onMessage(JSON.parse(msg.body));\n              } catch (e) {\n                console.error(\"WebSocket parse error:\", e);\n              }\n            }\n          });\n          if (onConnect) onConnect();\n          resolve({\n            connected: true,\n            disconnect: () => {\n              try {\n                sub.unsubscribe();\n              } catch (e) {}\n              try {\n                stompClient.deactivate();\n              } catch (e) {}\n            }\n          });\n        },\n        onStompError: frame => {\n          console.error(\"STOMP error:\", frame.headers['message'], frame.body);\n          resolve({\n            connected: false,\n            disconnect: () => {}\n          });\n        }\n      });\n      stompClient.activate();\n    } catch (e) {\n      console.error(\"WebSocket init error:\", e);\n      resolve({\n        connected: false,\n        disconnect: () => {}\n      });\n    }\n  });\n}\nexport function sendEditViaWS(docId, payload) {\n  if (!stompClient || !stompClient.connected) return false;\n  try {\n    stompClient.publish({\n      destination: `/app/edit/${docId}`,\n      body: JSON.stringify(payload)\n    });\n    return true;\n  } catch (e) {\n    console.error(\"Send WS error:\", e);\n    return false;\n  }\n}","map":{"version":3,"names":["Client","SockJS","stompClient","connectWebSocket","docId","onMessage","onConnect","Promise","resolve","webSocketFactory","debug","reconnectDelay","sub","subscribe","msg","body","JSON","parse","e","console","error","connected","disconnect","unsubscribe","deactivate","onStompError","frame","headers","activate","sendEditViaWS","payload","publish","destination","stringify"],"sources":["C:/Users/Admin/Desktop/collab-editing-system/frontend/src/websocket.js"],"sourcesContent":["// websocket.js\r\nimport { Client } from '@stomp/stompjs';\r\nimport SockJS from 'sockjs-client';\r\n\r\nlet stompClient = null;\r\n\r\nexport function connectWebSocket(docId, onMessage, onConnect) {\r\n  return new Promise((resolve) => {\r\n    try {\r\n      stompClient = new Client({\r\n        webSocketFactory: () => new SockJS(\"http://localhost:8082/ws\"),\r\n        debug: () => {}, // disable logs\r\n        reconnectDelay: 5000, // auto reconnect every 5s\r\n        onConnect: () => {\r\n          const sub = stompClient.subscribe(`/topic/document/${docId}`, (msg) => {\r\n            if (msg.body) {\r\n              try {\r\n                onMessage(JSON.parse(msg.body));\r\n              } catch (e) {\r\n                console.error(\"WebSocket parse error:\", e);\r\n              }\r\n            }\r\n          });\r\n\r\n          if (onConnect) onConnect();\r\n\r\n          resolve({\r\n            connected: true,\r\n            disconnect: () => {\r\n              try { sub.unsubscribe(); } catch(e) {}\r\n              try { stompClient.deactivate(); } catch(e) {}\r\n            }\r\n          });\r\n        },\r\n        onStompError: (frame) => {\r\n          console.error(\"STOMP error:\", frame.headers['message'], frame.body);\r\n          resolve({ connected: false, disconnect: () => {} });\r\n        }\r\n      });\r\n\r\n      stompClient.activate();\r\n    } catch (e) {\r\n      console.error(\"WebSocket init error:\", e);\r\n      resolve({ connected: false, disconnect: () => {} });\r\n    }\r\n  });\r\n}\r\n\r\nexport function sendEditViaWS(docId, payload) {\r\n  if (!stompClient || !stompClient.connected) return false;\r\n  try {\r\n    stompClient.publish({\r\n      destination: `/app/edit/${docId}`,\r\n      body: JSON.stringify(payload)\r\n    });\r\n    return true;\r\n  } catch (e) {\r\n    console.error(\"Send WS error:\", e);\r\n    return false;\r\n  }\r\n}\r\n"],"mappings":"AAAA;AACA,SAASA,MAAM,QAAQ,gBAAgB;AACvC,OAAOC,MAAM,MAAM,eAAe;AAElC,IAAIC,WAAW,GAAG,IAAI;AAEtB,OAAO,SAASC,gBAAgBA,CAACC,KAAK,EAAEC,SAAS,EAAEC,SAAS,EAAE;EAC5D,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;IAC9B,IAAI;MACFN,WAAW,GAAG,IAAIF,MAAM,CAAC;QACvBS,gBAAgB,EAAEA,CAAA,KAAM,IAAIR,MAAM,CAAC,0BAA0B,CAAC;QAC9DS,KAAK,EAAEA,CAAA,KAAM,CAAC,CAAC;QAAE;QACjBC,cAAc,EAAE,IAAI;QAAE;QACtBL,SAAS,EAAEA,CAAA,KAAM;UACf,MAAMM,GAAG,GAAGV,WAAW,CAACW,SAAS,CAAC,mBAAmBT,KAAK,EAAE,EAAGU,GAAG,IAAK;YACrE,IAAIA,GAAG,CAACC,IAAI,EAAE;cACZ,IAAI;gBACFV,SAAS,CAACW,IAAI,CAACC,KAAK,CAACH,GAAG,CAACC,IAAI,CAAC,CAAC;cACjC,CAAC,CAAC,OAAOG,CAAC,EAAE;gBACVC,OAAO,CAACC,KAAK,CAAC,wBAAwB,EAAEF,CAAC,CAAC;cAC5C;YACF;UACF,CAAC,CAAC;UAEF,IAAIZ,SAAS,EAAEA,SAAS,CAAC,CAAC;UAE1BE,OAAO,CAAC;YACNa,SAAS,EAAE,IAAI;YACfC,UAAU,EAAEA,CAAA,KAAM;cAChB,IAAI;gBAAEV,GAAG,CAACW,WAAW,CAAC,CAAC;cAAE,CAAC,CAAC,OAAML,CAAC,EAAE,CAAC;cACrC,IAAI;gBAAEhB,WAAW,CAACsB,UAAU,CAAC,CAAC;cAAE,CAAC,CAAC,OAAMN,CAAC,EAAE,CAAC;YAC9C;UACF,CAAC,CAAC;QACJ,CAAC;QACDO,YAAY,EAAGC,KAAK,IAAK;UACvBP,OAAO,CAACC,KAAK,CAAC,cAAc,EAAEM,KAAK,CAACC,OAAO,CAAC,SAAS,CAAC,EAAED,KAAK,CAACX,IAAI,CAAC;UACnEP,OAAO,CAAC;YAAEa,SAAS,EAAE,KAAK;YAAEC,UAAU,EAAEA,CAAA,KAAM,CAAC;UAAE,CAAC,CAAC;QACrD;MACF,CAAC,CAAC;MAEFpB,WAAW,CAAC0B,QAAQ,CAAC,CAAC;IACxB,CAAC,CAAC,OAAOV,CAAC,EAAE;MACVC,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEF,CAAC,CAAC;MACzCV,OAAO,CAAC;QAAEa,SAAS,EAAE,KAAK;QAAEC,UAAU,EAAEA,CAAA,KAAM,CAAC;MAAE,CAAC,CAAC;IACrD;EACF,CAAC,CAAC;AACJ;AAEA,OAAO,SAASO,aAAaA,CAACzB,KAAK,EAAE0B,OAAO,EAAE;EAC5C,IAAI,CAAC5B,WAAW,IAAI,CAACA,WAAW,CAACmB,SAAS,EAAE,OAAO,KAAK;EACxD,IAAI;IACFnB,WAAW,CAAC6B,OAAO,CAAC;MAClBC,WAAW,EAAE,aAAa5B,KAAK,EAAE;MACjCW,IAAI,EAAEC,IAAI,CAACiB,SAAS,CAACH,OAAO;IAC9B,CAAC,CAAC;IACF,OAAO,IAAI;EACb,CAAC,CAAC,OAAOZ,CAAC,EAAE;IACVC,OAAO,CAACC,KAAK,CAAC,gBAAgB,EAAEF,CAAC,CAAC;IAClC,OAAO,KAAK;EACd;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}